# RTS Camera

这是一个骑马与砍杀2：霸主的mod，能在战斗中以自由视角指挥，和更好的指挥命令。

## 存档兼容性
本mod不会读写你的存档数据。安装或卸载本mod不会对你的存档造成影响。

## 主要功能

本mod由两部分组成：自由视角 RTS Camera 和 指挥系统 Command System

- 自由视角 RTS Camera

  - 战斗中丝滑切换自由视角。

  - **新功能：** 让相机跟随选定的编队。

  - 玩家角色在战场上受伤后可控制下属士兵并继续战斗和指挥。

  - 兵牌可直接点击。

  - **新功能：** 可在藏身处快进并自动战斗。

- 指挥系统 Command System

  - 重做了游戏中的指挥系统。

  - **新功能：** 可将指令添加到指令队列，部队会挨个执行指令。例如，可让部队沿给定路径移动，然后开始射击或冲锋。

  - **新功能：** 你同时对多个编队下达命令时：

    - 移动和转向指令中，编队间的相对位置和方向会维持不变。

    - 当玩家在地面拖动编队宽度时，编队间的排布方式改进了。

  - **新功能：** 修复了游戏本体中跟编队宽度和单位间距相关的问题。

  - 可下达集中冲锋指令。

    - **新功能：** 可在下达集中攻击指令的同时维持原本的移动指令。例如，**让你的弓箭手待在原地同时攻击指定的目标**。

  - **新功能：** 修复游戏内的指令位置标记的若干问题。

  - 鼠标中键点击你的士兵来选择你的编队。

  - 自由视角下的移动目标标记替换成了更显眼的模型。

## 主要用法

- 自由视角 RTS Camera

  - 按`F10`可切换自由视角。

  - **新功能:** 自由视角下打开指挥界面后，按`E`键可让相机跟随选定的编队。

  - 玩家阵亡后后按`E`可以让相机跟随一个士兵，然后再按一次`E`控制该士兵继续战斗。

    - 你可以按`L`打开菜单，将`阵亡后控制队友`选项设置为“总是”，玩家阵亡后自动控制队友继续战斗。

  - 可通过点击兵牌来选择部队。
   
    - 可以按`Alt`显示鼠标以点击兵牌。

- 指挥系统 Command System

  - **新功能：** 按住`Shift`并下达指令，可将指令添加到指令队列。部队会挨个执行队列中的指令。

  - **新功能：** 若你同时移动/旋转多个编队，他们的相对位置和方向会锁定。

    - 当你拖动部队宽度时，多个编队间的排布改进了。

    - 当你在地面拖动部队时，按住`Ctrl`可锁定编队宽度和相对位置。

    - 按住`Alt`可禁用以上的锁定行为。

  - 鼠标中键点击敌人士兵来下达集中冲锋指令。

    - **新功能：** 鼠标中键点击同时按住`Alt`键，可在下达集中攻击指令的同时维持原有的移动指令不变。例如，**让你的弓箭手待在原地同时攻击指定的目标**。

  - 鼠标中键点击你的士兵来选择你的编队。

- 更多功能，你可看下面的`详细信息`，或者按`L`键打开mod菜单。

## 如何安装
* 解压下载的压缩包。将你下载的 `RTSCamera` 和 `RTSCamera.CommandSystem` 文件夹复制到 Bannerlord 的 `Modules` 文件夹下。
* 解除 (GamePath)\Modules\RTSCamera\bin\Win64_Shipping_Client 和 (GamePath)\Modules\RTSCamera.CommandSystem\bin\Win64_Shipping_Client 下所有 dll 文件的锁定：
  * 右键每个 dll 文件，点击“属性”，勾选“解除锁定”。
  * 或者：进入 (GamePath)\Modules，点击右键，打开 Powershell，然后运行：gci -Recurse RTSCamera* | Unblock-File

## 详细信息

- 战斗中按`L`键打开本mod的菜单。

  - 点击菜单左侧的`自由视角`和`指挥系统`来在两部分功能间切换。

  - 要关闭该菜单，你可以按`esc`键，左键点击菜单外的区域，或点击右键。

### 自由视角RTS Camera

- 按`F10`可切换自由视角。

  切换到自由视角时玩家角色会由AI操控。

  - 如果显示“死亡时无法下达指令”，请按两次E以控制一个单位，然后你就可以下达指令了。

  - 指挥界面会自动打开。

  - 你可以启用`指挥时切换相机`选项，指挥时自动切换到自由视角。

  - **新功能：** 自由视角下打开指挥界面后，按`E`键可让相机跟随选定的编队。

  - 你可以启用`自动慢速模式`，这样自由视角下自动开启慢速模式。

  - 自由视角下的操控：

    - 用`W`, `A`, `S`, `D`, `空格`, `Z`和鼠标滚轮来移动相机。

    - 用`shift`来加速移动相机。

    - 移动鼠标来旋转相机。或者当命令面板打开后，右键拖动鼠标来旋转相机。

    - 选中部队后左键在地面上拖动来改变部队的位置，方向和宽度。

    - 按住`ctrl`再按下方向键上下来调整镜头移动速度。

    - 按住`ctrl`并点击鼠标中键来重设鼠标速度。

    - 按住`ctrl`然后垂直拖动鼠标中键来调整相机高度。

- 玩家阵亡后后按`E`可以让相机跟随一个单位，然后再按一次`E`控制该士兵继续战斗。

  - 你可以设置`阵亡后控制队友`选项，玩家阵亡后自动控制队友，以避免你的部队变为由AI指挥。自由视角下玩家阵亡后会自动控制队友以避免中断指挥。

  - 玩家阵亡后会优先控制同编队的队友。

- 当相机跟随单位时，按`E`可控制该单位。以下方式可以让相机跟随单位：

  - 自由视角下按`E`控制玩家单位。

  - 按`L`打开菜单，在`观察另一个英雄单位`下拉列表中选择一个英雄单位。

  - 按`;`然后点击一个单位，随后按`E`。

  - 点击鼠标左右键可以更改相机跟随的单位。

- 可通过点击兵牌来选择部队。

- 如果玩家在地图上受伤然后碰到了敌军，尽管你不能直接上战场，但可以选择`指挥这场战斗`选项来开始战斗。该战斗中你可以在自由视角下指挥部队，但不能直接控制任何一个单位。

- 启用`限制相机距离`选项后，自由视角下相机到玩家角色的距离会被限制。

  - 最大距离由侦察和战术等级决定。

  - 启用`限制相机距离`选项后，使用自由视角和在自由视角中指挥，会提高侦察和战术等级。

### 指挥系统Command System
  - **新功能：** 按住`Shift`下达指令时，可将指令添加到队列。你的部队会依次执行队列中的指令。

    - 如果你在下达指令时没有按住`Shift`，队列会被清空。

    - 队列中的移动目标会以旗帜标记。

    - 在自由视角模式下，移动路径会用箭头标记。

  - **新功能：** 如果你同时移动/旋转多个编队，它们的相对位置和方向会被锁定。

    - 如果你通过在地面拖动来下达移动指令，编队的排列会比原版游戏更合理。

    - 按住`Ctrl`在地面拖动时，编队的相对位置和宽度会被锁定。

    - 如果你不想要上述锁定行为，按住`Alt`即可恢复原有行为。

  - **新功能：** 修复了原版游戏中的以下问题：

    - 问题：切换到圆形阵型再切回线形阵型时，阵型宽度会变得异常长。

    - 问题：如果你通过在地面拖动来缩小阵型宽度和单位间距，然后在下一个指令中移动阵型，预览中的单位间距与实际下达的指令不一致。

    - 问题：如果你通过点击地面将阵型放到狭窄的位置，然后在下一个指令中将其移回，阵型宽度不会恢复。在本mod中，只有你拖动地面时才会改变阵型宽度。

    - 问题：（尤其是圆形/方形阵型）如果你将阵型宽度拖到最小，按`F1`并将指令旗帜放在靠近墙的位置但不实际下达指令，帧率会急剧下降。

    - 问题：攻城时如果你试图下达攻击城门的指令，可能会导致部队去攻击城门后的敌方编队。

- 鼠标中键点击敌人士兵来下达集中冲锋指令。

  - 敌军被消灭以后，你的部队会待在原地。要改变这个行为，你可以按`L`打开菜单，然后把选项`消灭敌方编队后`设置为`冲锋`。

  - 自由视角下打开指挥界面后，被攻击的敌方编队会用红色高亮。

- **新功能：** 鼠标中键点击同时按住`Alt`键，可在下达集中攻击指令的同时维持原有的移动指令不变。

  - 对于弓箭手，可以让他们攻击指定目标同时待在原地。

  - 注意对于近战士兵，他们仍会执行之前的移动指令，这可能让他们无法攻击到目标。

- 移动目标标记更加显眼。游戏原本的标记在相机太远时很难辨别。

- 鼠标中键点击你的士兵来选择你的编队。

  - 指挥面板打开时，选中的编队会用绿色标记。

- 自由视角下打开指挥界面后，你被敌方攻击的编队会用深蓝色高亮。

- 兵牌下方会显示当前移动指令。

- 玩家可使用空心方阵。对AI不生效。

- 修复方阵角落士兵朝向的问题。

## 快捷键
你可以按`L`打开菜单，然后点击`按键绑定`来设置快捷键。

你可以点击`添加快捷键`按钮来增加快捷键触发方式。

你可以点击`扩展组合键`来编辑快捷组合键。组合键中所有按键都按下时才会触发对应功能。

以下是默认快捷键：

RTS Camera:

- `L`: 打开菜单。

- `F10`: 切换自由视角

- `E`: 相机跟随单位/编队；控制单位。

- `;`: 选择单位。

- `w`, `A`, `S`, `D`: 相机移动。

- `Space`, `Z`: 相机升降。

- `Right Shift` + `=`, `Right Shift` + `-`: 提高/降低相机距离限制。

Command System:

- `鼠标中键`: 选择编队。

- `左Alt` 或 `右Alt`: 攻击敌方编队时保持移动指令；切换编队锁定行为。

- `左Shift` 或 `右Shift`: 将指令添加到队列。

- `左Ctrl` 或 `右Ctrl`: 拖动时保持编队宽度不变。

还有更多快捷键可设置，但为了防误触我把它们禁用了。要想设置，请按`L`打开菜单，然后点击`按键绑定`。


## 配置文件
本mod的配置保存在文件夹`(user directory)\Documents\Mount and Blade II Bannerlord\Configs\RTSCamera\`和`(user directory)\Documents\Mount and Blade II Bannerlord\Configs\MissionLibrary\`中。

  主要配置保存在文件`RTSCameraConfig.xml`和`CommandSystemConfig.xml`中。

  按键配置保存在文件`RTSCameraGameKeyConfig.xml`和`CommandSystemGameKeyConfig.xml`中。

  打开mod菜单的按键配置保存在文件`(user directory)\Documents\Mount and Blade II Bannerlord\Configs\MissionLibrary\GeneralGameKeyConfig.xml`中。

  你可以修改配置，但如果你编辑有误或配置文件被移除，配置会被初始化为默认内容。

## 解决问题
- 若启动器无法启动：

  - 卸载所有第三方mod，然后一个个重装它们来找出哪个mod导致了启动器不能启动。

- 若提示"Unable to initialize Steam API":

  - 请先启动Steam，并确保砍二在你登录的Steam账号的库中.

- 若mod启用后游戏崩溃：

  - 若提示: `Cannot load: ..\..\Modules\RTSCamera\bin\Win64_Shipping_Client\RTSCamera.dll`，请将`Modules\RTSCamera`和`Modules\RTSCamera.CommandSystem`下的所有dll文件解除锁定。

  - 若你能将dump文件发送给我来帮助我解决你的崩溃问题，我会十分感谢。步骤如下：

    - 游戏崩溃时在弹窗询问是否收集信息时点击`是`或`Yes`。

    - 在游戏把崩溃信息发送给TaleWorlds之前，到`C:\ProgramData\Mount and Blade II Bannerlord\crashes`中(**注意不是游戏安装路径**)根据时间找到与该崩溃相关的文件夹。

    - 将该文件夹中的`dump.dmp`文件发送给我。

- 若你忘了你设置的用哪个按键打开mod菜单：

  - 你可以移除文件`(user directory)\Documents\Mount and Blade II Bannerlord\Configs\MissionLibrary\GeneralGameKeyConfig.xml`，这样打开mod菜单的按键会恢复为默认。

## 其他mod
- ["Battle Mini Map"](https://www.nexusmods.com/mountandblade2bannerlord/mods/2672): 战斗小地图.

- ["Improved Combat AI"](https://www.nexusmods.com/mountandblade2bannerlord/mods/449/): 可调整战斗AI，可选择更真实的格挡。

- ["Cinematic Camera"](https://www.nexusmods.com/mountandblade2bannerlord/mods/1627): 调整相机参数，如移动速度，景深等等。

## 源代码

你可以在[github.com](https://github.com/lzh-mb-mod/RTSCamera)获取到源代码。

## 联系方式
- 邮箱：

  - lizhenhuan1019@outlook.com

  - lizhenhuan1019@qq.com
